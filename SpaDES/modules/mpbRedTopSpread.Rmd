---
title: "Mountain Pine Beetle Red Top Spread Model"
author: "Barry J. Cooke and Alex M. Chubaty"
date: "August 13, 2015"
output: html_document
bibliography: bibliography.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE, echo = TRUE, eval = FALSE, message = FALSE)

setwd("~/GitHub/MPB/SpaDES")
```

The goal of this model is to simulate the spread of mountain pine beetle outbreaks as a function of the growth and dispersal of beetle-killed trees, called "red tops".
Recruitment is an annual process, with the inter-annual recruitment function taking a variety of possible forms, depending who one takes as an authority on the question.
@Berryman:1979bs was an early pioneer who inspired much work in the area, and there are several possible interpretation of the data he used from Glacier and Yellowtone National Parks in MO and WY the 1960s.
Consequently, the module offers the option of using any of four possible interpretations.
Two addiitonal options are forthcoming at the time of writing.
The first of these is a high-order polynomial fit to Berryman's hand-drawn curve.
The second is the linearized multi-niche model of @Berryman:1999bk, which, oddly & inexplicably, held endemic-niche dynamics as a fast process (`R[t] ~ X[t-1]`), and epidemic-niche dynamics as a lagged process (`R[t] ~ X[t-2]`).

Calculating the initial density of red tops and the effect of growth in their number requires read and write access to a forest landscape of some sort.

Dispersal is currently a stub.

-----

### Install and load necessary packages

Install the most recent version of the `SpaDES` package.

```{r install-spades}
#options(repos = c(CRAN = "https://cran.rstudio.com/"))

# most recent stable version:
install.packages("SpaDES")

# the most recent development version (unstable):
devtools::install_github("PredictiveEcology/SpaDES@development", dependencies = TRUE)
```

Load the packages needed to run the code blocks in this document.

```{r attach-spades, echo=FALSE, message=FALSE}
# load packages
library(igraph) # this exports `magrittr`'s pipe, but using magrittr here causes conflicts.
library(SpaDES)
stopifnot(packageVersion("SpaDES") >= "1.3.1.9020")
```

Additional packages loaded automatically by the modules do not need to be explicitly loaded at this point:

```{r module-packages}
library(ggplot2)
library(RandomFields) # temporarily used to generate random maps
library(raster)
library(RColorBrewer)
```

### Simulation setup

#### Berryman's 1979 data (fitted)

```{r berryman1979fit, eval=TRUE}
clearPlot()

simB79fit <- simInit(
  times = list(start = 0.0, end = 10.0, timeunit = "year"),
  params = list(
    .globals = list(stackName = "landscape", climateMap = "climate"),
    mpbGrowth_B79fit = list(.plotInitialTime = 1, .plotInterval = 1),
    mpbRandomLandscapes = list(.plotInitialTime = 1, .plotInterval = 1, nx = 100, ny = 100),
    mpbClimate = list(.plotInitialTime = 1, .plotInterval = 1, nx = 100, ny = 100, updateInterval = 1),
    mpbMassAttacks = list(.plotInitialTime = 1, .plotInterval = NA)
  ),
  modules = list("mpbRandomLandscapes", #mpbPine,
                 "mpbClimate",
                 "mpbMassAttacks",
                 "mpbRedTopDispersal",
                 "mpbGrowth_B79fit"),
  paths = list(modulePath = "./modules")
) %>% spades(., debug = FALSE)
```

Simulation diagrams:

```{r berryman1979fit-diagrams, eval=TRUE}
moduleDiagram(simB79fit)
objectDiagram(simB79fit)
eventDiagram(simB79fit)
```

#### Berryman's 1979 data (forced)

```{r berryman1979forced, eval=TRUE}
clearPlot()

simB79forced <- simInit(
  times = list(start = 0.0, end = 10.0, timeunit = "year"),
  params = list(
    .globals = list(stackName = "landscape", climateMap = "climate"),
    MPBRedTopGrowth_B79forced = list(.plotInitialTime = 1, .plotInterval = 1),
    MPBRedTopLandscape = list(.plotInitialTime = 1, .plotInterval = 1, nx = 100, ny = 100),
    MPBRedTopClimate = list(.plotInitialTime = 1, .plotInterval = 1, nx = 100, ny = 100, updateInterval = 1),
    MPBRedTopMassAttacks = list(.plotInitialTime = 1, .plotInterval = NA),
    MPBRedTopImpacts = list(.plotInitialTime = 1, .plotInterval = 1)
  ),
    modules = list("mpbRandomLandscapes", #mpbPine,
                   "mpbClimate",
                   "mpbMassAttacks",
                   "mpbRedTopDispersal",
                   "mpbGrowth_B79forced"),
  paths = list(modulePath = "./modules")
) %>% spades(., debug = FALSE)
```

Simulation diagrams:

```{r berryman1979forced-diagrams, eval=TRUE}
moduleDiagram(simB79forced)
objectDiagram(simB79forced)
eventDiagram(simB79forced)
```

#### [add other simulations here]

add the other simulations (with different growth and dispersal types) here.

# Literature Cited

<!-- automatically generated using bibliography.bib -->
